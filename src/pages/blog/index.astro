---
const allPosts = import.meta.glob('../../pages/blog/*.md', { eager: true });

const posts = Object.entries(allPosts)
  .map(([path, mod]) => {
    const slug = path.replace('../../pages/blog/', '').replace('.md', '');
    return {
      url: `/blog/${slug}/`,
      title: (mod as any).frontmatter.title,
      date: (mod as any).frontmatter.date,
    };
  })
  .sort((a, b) => {
    const dateA = typeof a.date === 'string' ? a.date : a.date.toISOString();
    const dateB = typeof b.date === 'string' ? b.date : b.date.toISOString();
    return dateB.localeCompare(dateA);
  });

const formatDate = (date: any) => {
  const dateString = typeof date === 'string' ? date : date.toISOString();
  const [year, month, day] = dateString.split('T')[0].split('-');
  const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
  return `${day} ${monthNames[Number(month) - 1]}, ${year}`;
};
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="/index.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5">

  </head>
  <body>
    <header>
      <nav class="navbar">
          <a href="/">Home</a>
          <a href="/projects/">Projects</a>
          <a href="/blog/">Blog</a>
      </nav>
    </header>
    <h1>Entries</h1>
    <div class="posts">
      {posts.map(post => (
        <div class="post-item">
          <span class="date">{formatDate(post.date)}</span>
          <a href={post.url}>{post.title}</a>
        </div>
      ))}
    </div>
  </body>
</html>